<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä»£ç é«˜äº®ä¿®å¤æµ‹è¯•</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem;
            background: #f8fafc;
        }

        h1 {
            color: #1e293b;
            margin-bottom: 2rem;
        }

        .test-section {
            background: white;
            border-radius: 0.5rem;
            padding: 1.5rem;
            margin-bottom: 2rem;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        .test-section h2 {
            color: #374151;
            margin-top: 0;
            margin-bottom: 1rem;
        }

        .status {
            background: #f0fdf4;
            border: 1px solid #bbf7d0;
            color: #166534;
            padding: 1rem;
            border-radius: 0.5rem;
            margin: 1rem 0;
        }

        .error {
            background: #fef2f2;
            border-color: #fecaca;
            color: #dc2626;
        }

        /* æ¨¡æ‹Ÿ MessageItem çš„æ ·å¼ */
        .message-content {
            background: #f8fafc;
            border: 1px solid #e2e8f0;
            border-radius: 0.5rem;
            padding: 1rem;
            margin: 1rem 0;
        }

        /* åº”ç”¨ä¸ MessageItem.svelte ç›¸åŒçš„æ ·å¼ */
        .message-content .hljs {
            padding: 1rem !important;
            border-radius: 0.5rem !important;
            font-family: 'SF Mono', Monaco, 'Cascadia Code', 'Roboto Mono', Consolas, 'Courier New', monospace !important;
            font-size: 0.875rem !important;
            line-height: 1.5 !important;
            overflow-x: auto !important;
            margin: 0.5rem 0 !important;
        }

        .message-content .inline-code {
            background: rgba(0, 0, 0, 0.1) !important;
            padding: 0.125rem 0.25rem !important;
            border-radius: 0.25rem !important;
            font-size: 0.875rem !important;
            font-family: 'SF Mono', Monaco, 'Cascadia Code', 'Roboto Mono', Consolas, 'Courier New', monospace !important;
            color: #dc2626 !important;
        }
    </style>
    
    <!-- å¼•å…¥ highlight.js å’Œä¸»é¢˜ -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github-dark.min.css">
    
    <!-- å¼•å…¥ highlightjs-copy æ’ä»¶ -->
    <script src="https://unpkg.com/highlightjs-copy/dist/highlightjs-copy.min.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/highlightjs-copy/dist/highlightjs-copy.min.css">
</head>
<body>
    <h1>ğŸ”§ ä»£ç é«˜äº®ä¿®å¤æµ‹è¯•</h1>
    
    <div class="test-section">
        <h2>ä¿®å¤çŠ¶æ€</h2>
        <div id="fix-status" class="status">æ­£åœ¨æ£€æŸ¥ä¿®å¤æ•ˆæœ...</div>
    </div>

    <div class="test-section">
        <h2>JavaScript ä»£ç ç¤ºä¾‹</h2>
        <div class="message-content">
            <pre><code class="language-javascript">// è¿™æ˜¯ä¸€ä¸ª JavaScript ç¤ºä¾‹
function createMarkdownRenderer() {
  const md = new MarkdownIt({
    html: true,
    breaks: false,
    linkify: true,
    highlight: function (str, lang) {
      if (lang && hljs.getLanguage(lang)) {
        try {
          return hljs.highlight(str, { language: lang }).value;
        } catch (__) {}
      }
      return '';
    }
  });
  
  return md;
}

// åˆå§‹åŒ– highlightjs-copy æ’ä»¶
hljs.addPlugin(new CopyButtonPlugin({
  lang: 'zh-CN',
  callback: (text, el) => {
    console.log('ä»£ç å·²å¤åˆ¶åˆ°å‰ªè´´æ¿');
  }
}));</code></pre>
        </div>
    </div>

    <div class="test-section">
        <h2>Python ä»£ç ç¤ºä¾‹</h2>
        <div class="message-content">
            <pre><code class="language-python"># Python ä»£ç é«˜äº®æµ‹è¯•
import os
import sys
from typing import List, Dict, Optional

class CodeHighlighter:
    """ä»£ç é«˜äº®å¤„ç†å™¨"""
    
    def __init__(self, theme: str = "github-dark"):
        self.theme = theme
        self.languages = ["python", "javascript", "typescript", "css", "html"]
    
    def highlight_code(self, code: str, language: str) -> str:
        """é«˜äº®ä»£ç å—"""
        if language not in self.languages:
            return code
            
        # ä½¿ç”¨ highlight.js è¿›è¡Œé«˜äº®
        return f'<pre><code class="language-{language}">{code}</code></pre>'
    
    def process_markdown(self, content: str) -> str:
        """å¤„ç† Markdown å†…å®¹"""
        lines = content.split('\n')
        result = []
        
        for line in lines:
            if line.startswith('```'):
                # å¤„ç†ä»£ç å—
                result.append(self.highlight_code(line, 'markdown'))
            else:
                result.append(line)
        
        return '\n'.join(result)</code></pre>
        </div>
    </div>

    <div class="test-section">
        <h2>CSS ä»£ç ç¤ºä¾‹</h2>
        <div class="message-content">
            <pre><code class="language-css">/* CSS ä»£ç é«˜äº®æµ‹è¯• */
.message-content .hljs {
  padding: 1rem !important;
  border-radius: 0.5rem !important;
  font-family: 'SF Mono', Monaco, 'Cascadia Code', 'Roboto Mono', Consolas, 'Courier New', monospace !important;
  font-size: 0.875rem !important;
  line-height: 1.5 !important;
  overflow-x: auto !important;
  margin: 0.5rem 0 !important;
}

/* å†…è”ä»£ç æ ·å¼ */
.message-content .inline-code {
  background: rgba(0, 0, 0, 0.1) !important;
  padding: 0.125rem 0.25rem !important;
  border-radius: 0.25rem !important;
  font-size: 0.875rem !important;
  color: #dc2626 !important;
}

/* å“åº”å¼è®¾è®¡ */
@media (max-width: 768px) {
  .message-content .hljs {
    font-size: 0.75rem !important;
    padding: 0.75rem !important;
  }
}</code></pre>
        </div>
    </div>

    <div class="test-section">
        <h2>å†…è”ä»£ç æµ‹è¯•</h2>
        <div class="message-content">
            <p>è¿™é‡Œæœ‰ä¸€äº›å†…è”ä»£ç ç¤ºä¾‹ï¼š<code class="inline-code">const result = hljs.highlight(code, { language: 'javascript' })</code> å’Œ <code class="inline-code">import 'highlight.js/styles/github-dark.css'</code>ã€‚</p>
            <p>ä¿®å¤åçš„ä»£ç é«˜äº®åº”è¯¥ï¼š</p>
            <ul>
                <li>ä½¿ç”¨ <code class="inline-code">github-dark</code> ä¸»é¢˜</li>
                <li>æ­£ç¡®æ˜¾ç¤ºè¯­æ³•é«˜äº®é¢œè‰²</li>
                <li>åŒ…å«å¤åˆ¶æŒ‰é’®åŠŸèƒ½</li>
                <li>ä¿æŒè‰¯å¥½çš„å­—ä½“å’Œé—´è·</li>
            </ul>
        </div>
    </div>

    <script>
        // åˆå§‹åŒ– highlightjs-copy æ’ä»¶
        hljs.addPlugin(new CopyButtonPlugin({
            lang: 'zh-CN',
            callback: (text, el) => {
                console.log('ä»£ç å·²å¤åˆ¶åˆ°å‰ªè´´æ¿:', text.substring(0, 50) + '...');
                updateStatus('âœ… ä»£ç å¤åˆ¶æˆåŠŸï¼ä¿®å¤æ•ˆæœæ­£å¸¸ã€‚', false);
            }
        }));

        // é«˜äº®æ‰€æœ‰ä»£ç å—
        hljs.highlightAll();

        function updateStatus(message, isError = false) {
            const statusEl = document.getElementById('fix-status');
            statusEl.textContent = message;
            statusEl.className = isError ? 'status error' : 'status';
        }

        // æ£€æŸ¥ä¿®å¤æ•ˆæœ
        setTimeout(() => {
            const codeBlocks = document.querySelectorAll('.hljs');
            const copyButtons = document.querySelectorAll('.hljs-copy-button');
            
            console.log(`æ‰¾åˆ° ${codeBlocks.length} ä¸ªä»£ç å—`);
            console.log(`æ‰¾åˆ° ${copyButtons.length} ä¸ªå¤åˆ¶æŒ‰é’®`);
            
            if (codeBlocks.length > 0 && copyButtons.length > 0) {
                // æ£€æŸ¥æ˜¯å¦åº”ç”¨äº†æ­£ç¡®çš„ä¸»é¢˜æ ·å¼
                const firstCodeBlock = codeBlocks[0];
                const computedStyle = window.getComputedStyle(firstCodeBlock);
                const backgroundColor = computedStyle.backgroundColor;
                
                console.log('ä»£ç å—èƒŒæ™¯è‰²:', backgroundColor);
                
                updateStatus(`âœ… ä»£ç é«˜äº®ä¿®å¤æˆåŠŸï¼æ‰¾åˆ° ${codeBlocks.length} ä¸ªä»£ç å—å’Œ ${copyButtons.length} ä¸ªå¤åˆ¶æŒ‰é’®ã€‚ä¸»é¢˜æ ·å¼å·²æ­£ç¡®åº”ç”¨ã€‚`);
            } else {
                updateStatus('âŒ ä»£ç é«˜äº®ä¿®å¤å¤±è´¥ã€‚è¯·æ£€æŸ¥ highlight.js å’Œæ’ä»¶é…ç½®ã€‚', true);
            }
        }, 1000);
    </script>
</body>
</html>
