# 错误消息样式优化

## 优化内容

根据用户反馈，对错误消息进行了视觉和文案优化：

### 1. 视觉样式改进
- ✅ **红色错误标题** - 使用 `#dc2626` 红色突出显示错误类型
- ✅ **图标标识** - 每种错误类型都有对应的emoji图标
- ✅ **层次分明** - 标题、描述、建议分层显示
- ✅ **技术信息** - Request ID等技术信息用灰色小字显示

### 2. 文案优化
- ✅ **更友好的标题** - 从技术术语改为用户易懂的描述
- ✅ **具体的建议** - 提供可操作的解决步骤
- ✅ **时间指导** - 明确等待时间（如"等待2-5分钟"）
- ✅ **操作指引** - 具体说明如何操作（如"点击右侧工具栏⚙️"）

## 错误类型对比

### 429错误（频率限制）

**优化前：**
```
当前网络请求过于频繁，请稍后再试。(request id: xxx)

建议：
• 检查您的自定义 API 设置。
• 切换到 Sider以获得可靠的访问（这将开始一个新的对话）。
• 联系支持以获取帮助。
```

**优化后：**
```
⚠️ 请求频率限制

当前API请求过于频繁，服务器负载饱和，请稍后再试。

Request ID: xxx

💡 解决建议：
• 等待 2-5 分钟后重新发送消息
• 点击右侧工具栏 ⚙️ 检查API配置
• 尝试切换到其他可用的AI模型
• 如果问题持续，请联系技术支持
```

### 401错误（API密钥错误）

**优化后：**
```
🔑 API密钥验证失败

您的API密钥无效或已过期，请检查配置。

💡 解决建议：
• 点击右侧工具栏 ⚙️ 进入设置页面
• 检查API密钥是否正确输入
• 确认API密钥是否有效且未过期
• 联系API提供商确认密钥状态
```

### 网络错误

**优化后：**
```
🌐 网络连接错误

无法连接到AI服务，请检查网络连接。

💡 解决建议：
• 检查您的网络连接状态
• 尝试刷新页面后重试
• 检查防火墙或代理设置
• 稍后重新尝试
```

## 技术实现

### HTML样式内联
```typescript
return `<div style="color: #dc2626; font-weight: 500; margin-bottom: 12px;">
⚠️ 请求频率限制
</div>

当前API请求过于频繁，服务器负载饱和，请稍后再试。

**💡 解决建议：**
• 等待 2-5 分钟后重新发送消息
• 点击右侧工具栏 ⚙️ 检查API配置`;
```

### 技术信息样式
```typescript
<span style="color: #6b7280; font-size: 0.875em;">Request ID: ${requestId}</span>
```

### 错误详情框
```typescript
<div style="color: #6b7280; font-size: 0.875em; margin: 8px 0; padding: 8px; background: #f3f4f6; border-radius: 4px;">
错误详情: ${cleanError}
</div>
```

## 用户体验改进

### 1. 视觉识别
- **红色标题** - 立即识别为错误信息
- **图标标识** - 快速理解错误类型
- **层次结构** - 信息组织清晰

### 2. 可操作性
- **具体步骤** - 明确告诉用户该做什么
- **时间指导** - 告诉用户需要等待多久
- **位置指引** - 准确说明按钮位置

### 3. 信息完整性
- **保留技术信息** - Request ID等便于技术支持
- **友好描述** - 用户易懂的错误说明
- **多种建议** - 提供多个解决方案

## 支持的错误类型

| 错误类型 | 图标 | 标题 | 主要建议 |
|---------|------|------|----------|
| 429频率限制 | ⚠️ | 请求频率限制 | 等待2-5分钟 |
| 401认证失败 | 🔑 | API密钥验证失败 | 检查API密钥配置 |
| 403权限不足 | 🚫 | 访问被拒绝 | 检查权限设置 |
| 500服务器错误 | 🔧 | 服务器错误 | 等待5-10分钟 |
| 网络错误 | 🌐 | 网络连接错误 | 检查网络连接 |
| 配置错误 | ⚙️ | 模型未配置 | 进入设置配置 |
| 超时错误 | ⏱️ | 请求超时 | 简化问题重试 |
| 其他错误 | ❌ | 请求失败 | 联系技术支持 |

## 样式规范

### 颜色使用
- **错误红色**: `#dc2626` - 用于错误标题
- **灰色文字**: `#6b7280` - 用于技术信息
- **背景灰色**: `#f3f4f6` - 用于错误详情框

### 字体规范
- **标题**: `font-weight: 500` - 中等粗细
- **技术信息**: `font-size: 0.875em` - 小号字体
- **正文**: 默认字体大小和粗细

### 间距规范
- **标题下边距**: `margin-bottom: 12px`
- **详情框边距**: `margin: 8px 0`
- **详情框内边距**: `padding: 8px`

## 兼容性

- ✅ 支持HTML内联样式
- ✅ 兼容Markdown渲染
- ✅ 支持emoji图标
- ✅ 响应式设计

## 总结

这次优化显著提升了错误消息的用户体验：

- **视觉效果** - 红色标题和图标让错误更容易识别
- **文案质量** - 更友好、更具体、更可操作的建议
- **信息层次** - 清晰的信息组织和视觉层次
- **技术平衡** - 既保留技术信息又提供友好说明

现在用户遇到API错误时，能够快速理解问题并知道具体该如何解决。
