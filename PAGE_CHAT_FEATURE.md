# 🌐 网页聊天功能

## 🎯 功能概述

SlimPaneAI 现在支持**网页聊天模式**，让您可以直接与当前浏览的网页内容进行对话。这是一个简单而强大的功能，只需一个开关即可启用。

## ✨ 核心特性

### 🔄 简单开关控制
- **一键启用/关闭**：位于聊天输入框上方的开关按钮
- **状态指示**：实时显示当前模式和内容提取状态
- **智能提取**：自动提取当前页面的主要内容

### 🧠 智能内容处理
- **自动识别主要内容**：智能过滤导航、广告等无关元素
- **内容长度控制**：自动限制内容长度，避免Token超限
- **实时状态反馈**：显示提取进度和内容统计

### 💬 无缝聊天体验
- **自动上下文**：每次发送消息都会自动包含页面内容
- **保持对话**：在网页聊天模式下的所有对话都基于当前页面
- **即时切换**：随时开启或关闭网页聊天模式

## 🚀 使用方法

### 1. 启用网页聊天
1. 打开任意网页
2. 点击SlimPaneAI侧边栏
3. 在聊天输入框上方工具栏找到网页图标按钮（📄）
4. 点击按钮启用功能（按钮变为蓝色）

### 2. 查看提取状态
启用后，按钮右上角的状态指示器会显示：
- 🔵 **蓝色闪烁**：正在提取页面内容
- 🟢 **绿色圆点**：内容提取成功，可以开始对话
- 🔴 **红色圆点**：提取失败，可以重试

### 3. 开始对话
- 在输入框中输入您的问题
- 系统会自动将页面内容作为上下文发送给AI
- AI会基于页面内容回答您的问题

### 4. 关闭功能
- 再次点击网页聊天按钮即可关闭功能
- 按钮恢复灰色，状态指示器消失
- 关闭后恢复普通聊天模式

## 🎨 界面设计

### 开关组件
```
┌─────────────────────────────────────────────────────────┐
│ [gpt-4o ▼]              [🌐●]  [🗑️] [⚙️]              │
└─────────────────────────────────────────────────────────┘
```
- **位置**：聊天输入框上方工具栏，模型选择器右侧
- **状态指示**：右上角小圆点显示当前状态
  - 🔵 蓝色闪烁：正在提取内容
  - 🟢 绿色：内容提取成功
  - 🔴 红色：提取失败

### 状态指示
- **蓝色开关**：功能已启用
- **绿色勾号**：内容提取成功
- **红色感叹号**：提取失败
- **旋转图标**：正在提取

## 🔧 技术实现

### 内容提取逻辑
```typescript
// 智能提取主要内容
function extractSimplePageContent(): string {
  // 1. 尝试提取主要内容区域
  const mainContent = extractMainContentSimple();
  
  // 2. 如果主要内容不足，提取body内容
  if (mainContent.length < 100) {
    return extractBodyContentSimple();
  }
  
  return mainContent;
}
```

### 消息处理
```typescript
// 在发送消息时自动添加页面上下文
if (pageChatState.enabled && pageChatState.currentPageContent) {
  const pageContext = `基于以下网页内容回答问题：

标题：${pageChatState.currentPageTitle}
网址：${pageChatState.currentPageUrl}

内容：
${pageChatState.currentPageContent}

---

用户问题：${finalMessage}`;
  
  finalMessage = pageContext;
}
```

### 状态管理
```typescript
// 网页聊天状态
interface PageChatState {
  enabled: boolean;              // 是否启用
  currentPageContent: string;    // 页面内容
  currentPageTitle: string;      // 页面标题
  currentPageUrl: string;        // 页面URL
  isExtracting: boolean;         // 是否正在提取
  error: string | null;          // 错误信息
}
```

## 📋 支持的网页类型

### ✅ 完全支持
- **新闻文章**：自动识别文章正文
- **博客文章**：提取博客内容和标题
- **技术文档**：提取文档主要内容
- **学术论文**：提取论文摘要和正文
- **产品页面**：提取产品描述和详情

### ⚠️ 部分支持
- **社交媒体**：可能包含较多无关内容
- **电商网站**：需要手动筛选有用信息
- **复杂应用**：动态内容可能提取不完整

### ❌ 不支持
- **视频网站**：无法提取视频内容
- **图片网站**：无法识别图片内容
- **需要登录的页面**：可能无法访问内容

## 🎯 使用场景

### 📚 学习研究
- **论文解读**：让AI解释学术论文的关键内容
- **技术文档**：快速理解复杂的技术文档
- **新闻分析**：深入分析新闻事件和背景

### 💼 工作效率
- **内容总结**：快速总结长篇文章
- **信息提取**：从网页中提取关键信息
- **问题解答**：基于文档内容回答具体问题

### 🔍 信息理解
- **概念解释**：解释网页中的专业概念
- **背景补充**：补充相关背景知识
- **深度分析**：深入分析内容含义

## ⚡ 性能优化

### 内容提取优化
- **智能选择器**：优先提取主要内容区域
- **长度限制**：自动限制内容长度（约8000字符）
- **去重处理**：移除重复和无关内容

### 用户体验优化
- **即时反馈**：实时显示提取状态
- **错误处理**：友好的错误提示和重试机制
- **状态持久化**：记住用户的使用偏好

## 🔒 隐私保护

### 本地处理
- **本地提取**：所有内容提取在本地完成
- **无数据上传**：不向第三方服务发送页面内容
- **即时清理**：关闭功能后立即清理内容缓存

### 用户控制
- **完全可控**：用户完全控制功能的开启和关闭
- **透明操作**：所有操作对用户可见
- **数据安全**：不存储敏感页面内容

## 🚀 未来计划

### 即将推出
- **内容缓存**：缓存最近访问的页面内容
- **批量处理**：支持多个标签页的内容提取
- **自定义规则**：允许用户自定义提取规则

### 长期规划
- **PDF支持**：支持PDF文档的内容提取
- **图片识别**：OCR识别图片中的文字
- **视频字幕**：提取视频字幕内容

---

现在您可以享受更智能的网页聊天体验！只需一个开关，即可让AI理解您正在浏览的任何网页内容。🎉
