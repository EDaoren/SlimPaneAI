# 🔍 网页聊天功能调试步骤

## 🎯 问题现象
用户开启了网页聊天开关，但GPT回复说不知道在说什么，表明没有正确传递网页内容。

## 📋 调试步骤

### 第1步：重新加载扩展
1. 打开 `chrome://extensions/`
2. 找到 SlimPaneAI 扩展
3. 点击"重新加载"按钮
4. 刷新当前网页

### 第2步：检查按钮状态
1. 点击SlimPaneAI侧边栏
2. 查看聊天输入框上方的网页聊天按钮
3. 确认按钮状态：
   - 灰色 = 未启用
   - 蓝色 = 已启用
   - 蓝色+绿点 = 已启用且内容已提取
   - 蓝色+红点 = 已启用但提取失败

### 第3步：检查页面控制台
1. 在网页上按 `F12` 打开开发者工具
2. 切换到 `Console` 标签
3. 点击网页聊天按钮
4. 查看是否有以下日志：

**正常日志应该显示：**
```
SlimPaneAI: 内容脚本已初始化
SlimPaneAI: 页面URL: https://example.com
SlimPaneAI: 开始提取页面内容
SlimPaneAI: 提取的内容长度: 1234
SlimPaneAI: 内容块数量: 15
```

**如果没有日志，说明内容脚本未加载**

### 第4步：检查扩展控制台
1. 在 `chrome://extensions/` 中找到 SlimPaneAI
2. 点击"检查视图"中的"侧边栏"
3. 在控制台中查看日志：

**正常日志应该显示：**
```
SlimPaneAI: 尝试注入内容脚本到标签页: 123
SlimPaneAI: 内容脚本注入成功
SlimPaneAI: 尝试发送消息到内容脚本 (第1次)
SlimPaneAI: 收到内容脚本响应: {success: true, content: "...", title: "..."}
SlimPaneAI: 生成专业Prompt
SlimPaneAI: 任务类型: question
SlimPaneAI: 检测语言: zh
SlimPaneAI: 生成的Prompt长度: 2345
```

### 第5步：测试发送消息
1. 确保网页聊天按钮是蓝色（已启用）
2. 输入一个简单问题，如："这个页面讲的是什么？"
3. 发送消息
4. 查看扩展控制台的日志：

**应该看到：**
```
SlimPaneAI: 发送消息
SlimPaneAI: 用户消息: 这个页面讲的是什么？
SlimPaneAI: 是否网页聊天: true
SlimPaneAI: 完整消息长度: 2345
```

## 🚨 常见问题排查

### 问题1：按钮不变蓝
**现象**：点击网页聊天按钮，按钮保持灰色
**原因**：内容提取失败
**解决**：
1. 刷新页面
2. 检查是否在特殊页面（chrome://、about:等）
3. 重新加载扩展

### 问题2：按钮变蓝但有红点
**现象**：按钮是蓝色但右上角有红点
**原因**：内容提取失败
**解决**：
1. 查看页面控制台的错误信息
2. 尝试刷新页面后重新点击
3. 检查网页是否为动态加载内容

### 问题3：按钮正常但AI不理解
**现象**：按钮是蓝色+绿点，但AI回复不相关
**原因**：Prompt生成或发送有问题
**解决**：
1. 检查扩展控制台的Prompt生成日志
2. 确认"完整消息长度"大于用户消息长度
3. 检查是否有Prompt生成错误

### 问题4：完全没有日志
**现象**：控制台没有任何SlimPaneAI相关日志
**原因**：内容脚本未注入
**解决**：
1. 确保扩展有必要权限
2. 重新加载扩展
3. 刷新页面
4. 检查manifest.json配置

## 🔧 手动测试

### 测试内容提取
在页面控制台运行：
```javascript
// 测试基本内容提取
const body = document.body;
const content = body ? (body.innerText || body.textContent || '') : '';
console.log('页面内容长度:', content.length);
console.log('内容预览:', content.substring(0, 200));
```

### 测试消息发送
在扩展控制台运行：
```javascript
// 检查页面聊天状态
console.log('页面聊天状态:', window.pageChatStore);
```

## 📞 反馈信息

如果问题仍然存在，请提供：

1. **浏览器信息**：Chrome版本
2. **网站URL**：测试的具体网站
3. **按钮状态**：是否变蓝，是否有状态点
4. **控制台日志**：页面和扩展的完整日志
5. **错误信息**：任何红色错误信息

## 🎯 预期正常流程

1. **点击按钮** → 按钮变蓝
2. **内容提取** → 出现绿色状态点
3. **输入问题** → 看到用户原始问题
4. **发送消息** → 扩展控制台显示长Prompt
5. **AI回答** → 基于网页内容的相关回答

如果任何一步不正常，请按照对应的排查步骤进行检查。
