<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Readabilityä¿®å¤æµ‹è¯•</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            line-height: 1.6;
        }
        .test-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .success { background-color: #d4edda; border-color: #c3e6cb; }
        .error { background-color: #f8d7da; border-color: #f5c6cb; }
        .info { background-color: #d1ecf1; border-color: #bee5eb; }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover { background: #0056b3; }
        pre {
            background: #f8f9fa;
            padding: 10px;
            border-radius: 4px;
            overflow-x: auto;
        }
    </style>
</head>
<body>
    <h1>SlimPaneAI Readabilityä¿®å¤æµ‹è¯•</h1>
    
    <div class="test-section info">
        <h2>æµ‹è¯•è¯´æ˜</h2>
        <p>è¿™ä¸ªé¡µé¢ç”¨äºæµ‹è¯•Readabilityåº“çš„åŠ è½½å’Œå†…å®¹æå–åŠŸèƒ½æ˜¯å¦æ­£å¸¸å·¥ä½œã€‚</p>
        <p>ä¿®å¤å†…å®¹ï¼š</p>
        <ul>
            <li>âœ… ä¿®å¤äº†Readability.jsæ–‡ä»¶ä¸å­˜åœ¨çš„é—®é¢˜</li>
            <li>âœ… ä½¿ç”¨npmåŒ…@mozilla/readabilityæ›¿ä»£å¤–éƒ¨æ–‡ä»¶</li>
            <li>âœ… æ›´æ–°äº†manifest.jsonä¸­çš„web_accessible_resources</li>
            <li>âœ… ç§»é™¤äº†æ— æ•ˆçš„readability-loader.jsæ–‡ä»¶</li>
        </ul>
    </div>

    <div class="test-section">
        <h2>æµ‹è¯•å†…å®¹æå–</h2>
        <button onclick="testContentExtraction()">æµ‹è¯•å†…å®¹æå–</button>
        <div id="extraction-result"></div>
    </div>

    <div class="test-section">
        <h2>æµ‹è¯•Readabilityåº“åŠ è½½</h2>
        <button onclick="testReadabilityLoading()">æµ‹è¯•ReadabilityåŠ è½½</button>
        <div id="readability-result"></div>
    </div>

    <div class="test-section">
        <h2>æ§åˆ¶å°æ—¥å¿—</h2>
        <p>æ‰“å¼€æµè§ˆå™¨å¼€å‘è€…å·¥å…·æŸ¥çœ‹æ§åˆ¶å°ï¼Œåº”è¯¥ä¸å†æœ‰ä»¥ä¸‹é”™è¯¯ï¼š</p>
        <ul>
            <li>âŒ <code>Denying load of chrome-extension://*/lib/readability/Readability.js</code></li>
            <li>âŒ <code>GET chrome-extension://invalid/ net::ERR_FAILED</code></li>
        </ul>
    </div>

    <!-- æµ‹è¯•å†…å®¹ -->
    <article class="test-content">
        <h2>æµ‹è¯•æ–‡ç« å†…å®¹</h2>
        <p class="author">ä½œè€…ï¼šæµ‹è¯•ä½œè€…</p>
        <p class="date">å‘å¸ƒæ—¶é—´ï¼š2024-01-01</p>
        <div class="tags">
            <span class="tag">æŠ€æœ¯</span>
            <span class="tag">æµ‹è¯•</span>
        </div>
        
        <h3>æ–‡ç« æ­£æ–‡</h3>
        <p>è¿™æ˜¯ä¸€æ®µæµ‹è¯•å†…å®¹ï¼Œç”¨äºéªŒè¯Readabilityåº“æ˜¯å¦èƒ½å¤Ÿæ­£ç¡®æå–é¡µé¢çš„ä¸»è¦å†…å®¹ã€‚</p>
        <p>Readabilityåº“åº”è¯¥èƒ½å¤Ÿè¯†åˆ«è¿™äº›æ®µè½ä½œä¸ºä¸»è¦å†…å®¹ï¼Œå¹¶è¿‡æ»¤æ‰é¡µé¢ä¸­çš„å™ªéŸ³å…ƒç´ ã€‚</p>
        
        <h4>å­æ ‡é¢˜</h4>
        <p>è¿™é‡Œæ˜¯æ›´å¤šçš„æµ‹è¯•å†…å®¹ï¼ŒåŒ…å«äº†ä¸åŒçš„HTMLç»“æ„æ¥æµ‹è¯•æå–çš„å‡†ç¡®æ€§ã€‚</p>
        
        <ul>
            <li>åˆ—è¡¨é¡¹ç›®1</li>
            <li>åˆ—è¡¨é¡¹ç›®2</li>
            <li>åˆ—è¡¨é¡¹ç›®3</li>
        </ul>
        
        <blockquote>
            è¿™æ˜¯ä¸€ä¸ªå¼•ç”¨å—ï¼Œåº”è¯¥è¢«æ­£ç¡®è¯†åˆ«å’Œæå–ã€‚
        </blockquote>
    </article>

    <!-- å™ªéŸ³å†…å®¹ -->
    <div class="ad">è¿™æ˜¯å¹¿å‘Šå†…å®¹ï¼Œåº”è¯¥è¢«è¿‡æ»¤æ‰</div>
    <nav>è¿™æ˜¯å¯¼èˆªå†…å®¹ï¼Œåº”è¯¥è¢«è¿‡æ»¤æ‰</nav>
    <footer>è¿™æ˜¯é¡µè„šå†…å®¹ï¼Œåº”è¯¥è¢«è¿‡æ»¤æ‰</footer>

    <script>
        async function testContentExtraction() {
            const resultDiv = document.getElementById('extraction-result');
            resultDiv.innerHTML = '<p>æ­£åœ¨æµ‹è¯•å†…å®¹æå–...</p>';
            
            try {
                // å‘é€æ¶ˆæ¯ç»™content scriptè¿›è¡Œå†…å®¹æå–
                const response = await new Promise((resolve, reject) => {
                    chrome.runtime.sendMessage({
                        type: 'extract-content'
                    }, (response) => {
                        if (chrome.runtime.lastError) {
                            reject(chrome.runtime.lastError);
                        } else {
                            resolve(response);
                        }
                    });
                });
                
                if (response && response.success) {
                    resultDiv.innerHTML = `
                        <div class="success">
                            <h4>âœ… å†…å®¹æå–æˆåŠŸ</h4>
                            <p><strong>æ ‡é¢˜:</strong> ${response.title || 'æ— æ ‡é¢˜'}</p>
                            <p><strong>å†…å®¹é•¿åº¦:</strong> ${response.content ? response.content.length : 0} å­—ç¬¦</p>
                            <details>
                                <summary>æŸ¥çœ‹æå–çš„å†…å®¹</summary>
                                <pre>${response.content ? response.content.substring(0, 500) + '...' : 'æ— å†…å®¹'}</pre>
                            </details>
                        </div>
                    `;
                } else {
                    resultDiv.innerHTML = `
                        <div class="error">
                            <h4>âŒ å†…å®¹æå–å¤±è´¥</h4>
                            <p>é”™è¯¯ä¿¡æ¯: ${response ? response.error : 'æœªçŸ¥é”™è¯¯'}</p>
                        </div>
                    `;
                }
            } catch (error) {
                resultDiv.innerHTML = `
                    <div class="error">
                        <h4>âŒ æµ‹è¯•å¤±è´¥</h4>
                        <p>é”™è¯¯ä¿¡æ¯: ${error.message}</p>
                        <p>è¿™å¯èƒ½æ˜¯å› ä¸ºæ‰©å±•æœªæ­£ç¡®åŠ è½½æˆ–æƒé™é—®é¢˜ã€‚</p>
                    </div>
                `;
            }
        }
        
        async function testReadabilityLoading() {
            const resultDiv = document.getElementById('readability-result');
            resultDiv.innerHTML = '<p>æ­£åœ¨æµ‹è¯•Readabilityåº“åŠ è½½...</p>';
            
            try {
                // æ£€æŸ¥window.Readabilityæ˜¯å¦å­˜åœ¨
                if (typeof window.Readability !== 'undefined') {
                    resultDiv.innerHTML = `
                        <div class="success">
                            <h4>âœ… Readabilityåº“å·²åŠ è½½</h4>
                            <p>window.Readability å­˜åœ¨ä¸”å¯ç”¨</p>
                        </div>
                    `;
                } else {
                    resultDiv.innerHTML = `
                        <div class="info">
                            <h4>â„¹ï¸ Readabilityåº“æœªåœ¨å…¨å±€ä½œç”¨åŸŸ</h4>
                            <p>è¿™æ˜¯æ­£å¸¸çš„ï¼Œå› ä¸ºåº“æ˜¯åœ¨content scriptä¸­åŠ¨æ€åŠ è½½çš„</p>
                            <p>è¯·ä½¿ç”¨"æµ‹è¯•å†…å®¹æå–"æŒ‰é’®æ¥éªŒè¯åŠŸèƒ½æ˜¯å¦æ­£å¸¸</p>
                        </div>
                    `;
                }
            } catch (error) {
                resultDiv.innerHTML = `
                    <div class="error">
                        <h4>âŒ æµ‹è¯•å¤±è´¥</h4>
                        <p>é”™è¯¯ä¿¡æ¯: ${error.message}</p>
                    </div>
                `;
            }
        }
        
        // é¡µé¢åŠ è½½å®Œæˆåè‡ªåŠ¨è¿è¡Œä¸€äº›æ£€æŸ¥
        document.addEventListener('DOMContentLoaded', function() {
            console.log('ğŸ”§ SlimPaneAIæµ‹è¯•é¡µé¢å·²åŠ è½½');
            console.log('ğŸ“‹ è¯·æ£€æŸ¥æ§åˆ¶å°æ˜¯å¦æœ‰Readabilityç›¸å…³çš„é”™è¯¯ä¿¡æ¯');
            
            // æ£€æŸ¥æ˜¯å¦æœ‰chromeæ‰©å±•ç¯å¢ƒ
            if (typeof chrome !== 'undefined' && chrome.runtime) {
                console.log('âœ… Chromeæ‰©å±•ç¯å¢ƒæ£€æµ‹æˆåŠŸ');
            } else {
                console.log('âŒ æœªæ£€æµ‹åˆ°Chromeæ‰©å±•ç¯å¢ƒï¼ŒæŸäº›æµ‹è¯•å¯èƒ½æ— æ³•è¿è¡Œ');
            }
        });
    </script>
</body>
</html>
