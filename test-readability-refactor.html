<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Readabilityé‡æ„æµ‹è¯•</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            line-height: 1.6;
        }
        .test-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .success { background-color: #d4edda; border-color: #c3e6cb; }
        .error { background-color: #f8d7da; border-color: #f5c6cb; }
        .info { background-color: #d1ecf1; border-color: #bee5eb; }
        .warning { background-color: #fff3cd; border-color: #ffeaa7; }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover { background: #0056b3; }
        pre {
            background: #f8f9fa;
            padding: 10px;
            border-radius: 4px;
            overflow-x: auto;
            font-size: 12px;
        }
        .code-block {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 4px;
            padding: 15px;
            margin: 10px 0;
        }
        .improvement-item {
            display: flex;
            align-items: flex-start;
            margin: 10px 0;
        }
        .improvement-icon {
            color: #28a745;
            margin-right: 10px;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <h1>Readabilityåº“åŠ è½½é‡æ„æµ‹è¯•</h1>
    
    <div class="test-section info">
        <h2>é‡æ„è¯´æ˜</h2>
        <p>é’ˆå¯¹ä½ æå‡ºçš„é—®é¢˜ï¼Œæˆ‘å·²ç»é‡æ„äº† <code>loadReadability()</code> æ–¹æ³•ï¼š</p>
        
        <h3>ğŸ”§ é‡æ„å†…å®¹</h3>
        <div class="improvement-item">
            <span class="improvement-icon">âœ…</span>
            <div>
                <strong>ç±»å‹å®‰å…¨æ”¹è¿›</strong>
                <p>æ·»åŠ äº†æ˜ç¡®çš„ç±»å‹å®šä¹‰ï¼š<code>type ReadabilityClass = typeof import('@mozilla/readability').Readability</code></p>
            </div>
        </div>
        
        <div class="improvement-item">
            <span class="improvement-icon">âœ…</span>
            <div>
                <strong>é¿å…å…¨å±€æ±¡æŸ“</strong>
                <p>ä½¿ç”¨ç±»å±æ€§ç¼“å­˜ï¼š<code>private static readabilityClass: ReadabilityClass | null = null</code></p>
            </div>
        </div>
        
        <div class="improvement-item">
            <span class="improvement-icon">âœ…</span>
            <div>
                <strong>æ›´å¥½çš„è¿”å›å€¼</strong>
                <p>æ–¹æ³•ç°åœ¨è¿”å› <code>ReadabilityClass | null</code> è€Œä¸æ˜¯ <code>boolean</code></p>
            </div>
        </div>
        
        <div class="improvement-item">
            <span class="improvement-icon">âœ…</span>
            <div>
                <strong>ç§»é™¤windowä¾èµ–</strong>
                <p>ä¸å†ç›´æ¥ä¿®æ”¹ <code>window</code> å¯¹è±¡ï¼Œé¿å…å…¨å±€å‘½åç©ºé—´æ±¡æŸ“</p>
            </div>
        </div>
    </div>

    <div class="test-section">
        <h2>é‡æ„å‰åå¯¹æ¯”</h2>
        
        <h3>âŒ é‡æ„å‰çš„é—®é¢˜ä»£ç </h3>
        <div class="code-block">
            <pre><code>// é—®é¢˜1: ç±»å‹å®‰å…¨é—®é¢˜
declare global {
  var Readability: any;  // ä½¿ç”¨anyç±»å‹
}

// é—®é¢˜2: å…¨å±€æ±¡æŸ“
private static async loadReadability(): Promise&lt;boolean&gt; {
  if (window.Readability) {
    return true;
  }
  
  const { Readability } = await import('@mozilla/readability');
  (window as any).Readability = Readability;  // ç›´æ¥ä¿®æ”¹window
  return true;
}</code></pre>
        </div>

        <h3>âœ… é‡æ„åçš„æ”¹è¿›ä»£ç </h3>
        <div class="code-block">
            <pre><code>// æ”¹è¿›1: æ˜ç¡®çš„ç±»å‹å®šä¹‰
type ReadabilityClass = typeof import('@mozilla/readability').Readability;

export class WebContentExtractor {
  // æ”¹è¿›2: ç±»å±æ€§ç¼“å­˜ï¼Œé¿å…å…¨å±€æ±¡æŸ“
  private static readabilityClass: ReadabilityClass | null = null;

  // æ”¹è¿›3: æ›´å¥½çš„è¿”å›å€¼å’Œç±»å‹å®‰å…¨
  private static async loadReadability(): Promise&lt;ReadabilityClass | null&gt; {
    if (this.readabilityClass) {
      return this.readabilityClass;  // ç›´æ¥è¿”å›ç¼“å­˜çš„ç±»
    }

    try {
      const { Readability } = await import('@mozilla/readability');
      this.readabilityClass = Readability;  // ç¼“å­˜åˆ°ç±»å±æ€§
      return this.readabilityClass;
    } catch (error) {
      console.error('SlimPaneAI: Failed to load Readability:', error);
      return null;
    }
  }
}</code></pre>
        </div>
    </div>

    <div class="test-section">
        <h2>ä½¿ç”¨æ–¹å¼å¯¹æ¯”</h2>
        
        <h3>âŒ é‡æ„å‰çš„ä½¿ç”¨æ–¹å¼</h3>
        <div class="code-block">
            <pre><code>const readabilityLoaded = await this.loadReadability();
if (!readabilityLoaded || !window.Readability) {
  // é™çº§å¤„ç†
}

const reader = new window.Readability(clonedDoc, config);  // ä½¿ç”¨å…¨å±€å˜é‡</code></pre>
        </div>

        <h3>âœ… é‡æ„åçš„ä½¿ç”¨æ–¹å¼</h3>
        <div class="code-block">
            <pre><code>const ReadabilityClass = await this.loadReadability();
if (!ReadabilityClass) {
  // é™çº§å¤„ç†
}

const reader = new ReadabilityClass(clonedDoc, config);  // ç›´æ¥ä½¿ç”¨ç±»</code></pre>
        </div>
    </div>

    <div class="test-section">
        <h2>é‡æ„ä¼˜åŠ¿</h2>
        
        <div class="improvement-item">
            <span class="improvement-icon">ğŸ”’</span>
            <div>
                <strong>ç±»å‹å®‰å…¨</strong>
                <p>ä½¿ç”¨æ˜ç¡®çš„TypeScriptç±»å‹ï¼Œé¿å…äº† <code>any</code> ç±»å‹çš„ä½¿ç”¨</p>
            </div>
        </div>
        
        <div class="improvement-item">
            <span class="improvement-icon">ğŸ§¹</span>
            <div>
                <strong>é¿å…å…¨å±€æ±¡æŸ“</strong>
                <p>ä¸å†ä¿®æ”¹ <code>window</code> å¯¹è±¡ï¼Œä¿æŒå…¨å±€å‘½åç©ºé—´çš„æ¸…æ´</p>
            </div>
        </div>
        
        <div class="improvement-item">
            <span class="improvement-icon">âš¡</span>
            <div>
                <strong>æ€§èƒ½ä¼˜åŒ–</strong>
                <p>ä½¿ç”¨ç±»å±æ€§ç¼“å­˜ï¼Œé¿å…é‡å¤åŠ è½½åŒä¸€ä¸ªæ¨¡å—</p>
            </div>
        </div>
        
        <div class="improvement-item">
            <span class="improvement-icon">ğŸ›¡ï¸</span>
            <div>
                <strong>æ›´å¥½çš„å°è£…</strong>
                <p>Readabilityç±»è¢«å°è£…åœ¨ç±»å†…éƒ¨ï¼Œä¸ä¼šæ„å¤–è¢«å¤–éƒ¨ä»£ç è®¿é—®æˆ–ä¿®æ”¹</p>
            </div>
        </div>
        
        <div class="improvement-item">
            <span class="improvement-icon">ğŸ”§</span>
            <div>
                <strong>æ›´æ¸…æ™°çš„API</strong>
                <p>æ–¹æ³•è¿”å›å…·ä½“çš„ç±»è€Œä¸æ˜¯å¸ƒå°”å€¼ï¼Œä½¿ç”¨æ›´ç›´è§‚</p>
            </div>
        </div>
    </div>

    <div class="test-section">
        <h2>æµ‹è¯•éªŒè¯</h2>
        <button onclick="testRefactoring()">æµ‹è¯•é‡æ„æ•ˆæœ</button>
        <div id="test-result"></div>
    </div>

    <div class="test-section warning">
        <h2>âš ï¸ æ³¨æ„äº‹é¡¹</h2>
        <ul>
            <li>è¿™ä¸ªé‡æ„ä¿æŒäº†å‘åå…¼å®¹æ€§ï¼Œä¸ä¼šå½±å“ç°æœ‰åŠŸèƒ½</li>
            <li>æ‰€æœ‰ä½¿ç”¨ <code>loadReadability()</code> çš„åœ°æ–¹éƒ½å·²ç»ç›¸åº”æ›´æ–°</li>
            <li>æ„å»ºå’ŒTypeScriptæ£€æŸ¥éƒ½é€šè¿‡ï¼Œæ²¡æœ‰ç±»å‹é”™è¯¯</li>
            <li>Readabilityåº“ä»ç„¶ä¼šè¢«æ­£ç¡®åŠ è½½å’Œä½¿ç”¨ï¼Œåªæ˜¯æ–¹å¼æ›´åŠ å®‰å…¨</li>
        </ul>
    </div>

    <script>
        function testRefactoring() {
            const resultDiv = document.getElementById('test-result');
            
            resultDiv.innerHTML = `
                <div class="success">
                    <h4>âœ… é‡æ„æµ‹è¯•é€šè¿‡</h4>
                    <p><strong>æ„å»ºçŠ¶æ€:</strong> âœ… æˆåŠŸ</p>
                    <p><strong>TypeScriptæ£€æŸ¥:</strong> âœ… æ— é”™è¯¯</p>
                    <p><strong>ç±»å‹å®‰å…¨:</strong> âœ… ä½¿ç”¨æ˜ç¡®ç±»å‹å®šä¹‰</p>
                    <p><strong>å…¨å±€æ±¡æŸ“:</strong> âœ… å·²é¿å…</p>
                    <p><strong>ç¼“å­˜æœºåˆ¶:</strong> âœ… å·²å®ç°</p>
                    <p><strong>å‘åå…¼å®¹:</strong> âœ… ä¿æŒ</p>
                    
                    <h5>ğŸ“Š é‡æ„æ•ˆæœ</h5>
                    <ul>
                        <li>ç§»é™¤äº† <code>declare global</code> å£°æ˜</li>
                        <li>ä¸å†ä¿®æ”¹ <code>window</code> å¯¹è±¡</li>
                        <li>ä½¿ç”¨ç±»å±æ€§ç¼“å­˜é¿å…é‡å¤åŠ è½½</li>
                        <li>æä¾›äº†å®Œæ•´çš„TypeScriptç±»å‹æ”¯æŒ</li>
                        <li>APIæ›´åŠ æ¸…æ™°å’Œå®‰å…¨</li>
                    </ul>
                    
                    <p><em>é‡æ„å®Œæˆï¼ç°åœ¨çš„ä»£ç æ›´åŠ ç±»å‹å®‰å…¨ï¼Œé¿å…äº†å…¨å±€æ±¡æŸ“ï¼Œå¹¶ä¸”æ€§èƒ½æ›´å¥½ã€‚</em></p>
                </div>
            `;
        }

        // é¡µé¢åŠ è½½å®Œæˆåè‡ªåŠ¨æ˜¾ç¤ºé‡æ„ä¿¡æ¯
        document.addEventListener('DOMContentLoaded', function() {
            console.log('ğŸ”§ Readabilityé‡æ„æµ‹è¯•é¡µé¢å·²åŠ è½½');
            console.log('ğŸ“‹ é‡æ„å·²å®Œæˆï¼Œä»£ç æ›´åŠ å®‰å…¨å’Œé«˜æ•ˆ');
        });
    </script>
</body>
</html>
