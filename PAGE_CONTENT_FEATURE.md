# 🌐 基于当前网页问答功能

## 🎯 功能概述

SlimPaneAI 现在支持基于当前网页内容进行智能问答，让您可以直接与网页内容对话，获得更精准的回答。

## ✨ 核心特性

### 📄 智能内容提取
- **自动识别主要内容**：智能过滤导航、广告、侧边栏等无关元素
- **支持多种网页类型**：新闻、博客、文档、学术论文等
- **PDF文档支持**：使用PDF.js库实现PDF文档的文本提取
- **iframe内容提取**：支持嵌入式内容的提取

### 🏠 按域名记忆设置
- **智能域名识别**：自动为不同网站应用最佳提取设置
- **个性化配置**：为每个域名单独配置提取规则
- **设置持久化**：记住您对每个网站的偏好设置
- **批量管理**：支持导入/导出域名设置

### 🔧 高级提取配置
- **自定义选择器**：支持CSS选择器精确控制提取内容
- **Token限制管理**：智能估算和控制内容长度
- **内容过滤**：排除不需要的元素，只提取有价值的信息
- **实时预览**：提取前预览内容，确保准确性

### 📊 Token智能估算
- **多模型支持**：针对不同AI模型的Token计算规则
- **内容优化建议**：自动提示内容长度和优化建议
- **智能分块**：超长内容自动分块处理
- **使用统计**：实时显示Token使用情况

## 🚀 使用方法

### 1. 启用页面内容功能
1. 点击右侧工具栏的"页面内容"按钮 📄
2. 在弹出的面板中启用当前域名的内容提取
3. 系统会自动应用智能设置，也可手动调整

### 2. 提取网页内容
- **自动提取**：启用后自动提取当前页面内容
- **手动提取**：点击"提取内容"按钮手动获取
- **实时更新**：页面内容变化时自动更新

### 3. 与内容对话
1. 在页面内容面板中点击"使用此内容"
2. 内容会自动插入到聊天输入框
3. 输入您的问题，AI会基于页面内容回答

### 4. PDF文档处理
- **自动识别**：自动检测PDF文档并使用专用处理器
- **进度显示**：显示PDF处理进度和页面信息
- **分块处理**：大型PDF自动分块，避免Token限制
- **错误恢复**：处理失败时提供重试选项

## ⚙️ 高级设置

### 域名设置管理
```
设置 → 页面内容 → 域名设置
```

**基础设置：**
- 启用/禁用内容提取
- 自动提取开关
- 包含图片/链接
- 最大Token数限制

**高级设置：**
- 排除选择器（CSS）
- 包含选择器（CSS）
- 智能设置应用
- 设置导入/导出

### 智能设置预设

系统为常见网站类型提供智能设置：

**新闻网站：**
- 排除：相关文章、广告、社交分享
- 包含：文章内容、正文段落
- Token限制：12,000

**技术博客：**
- 排除：侧边栏、评论区
- 包含：文章正文、代码块
- Token限制：15,000

**学术网站：**
- 排除：导航、页脚
- 包含：摘要、全文
- Token限制：20,000

**文档网站：**
- 排除：导航、目录
- 包含：内容区域、文档正文
- Token限制：10,000

## 🎨 用户界面

### 页面内容面板
- **内容预览**：显示提取的内容摘要
- **Token统计**：实时显示Token使用情况
- **状态指示**：显示提取状态和进度
- **快速操作**：一键使用内容或刷新

### 工具栏集成
- **页面内容按钮**：快速访问内容面板
- **状态指示器**：显示当前域名启用状态
- **快捷操作**：直接从工具栏控制功能

### 设置界面
- **域名列表**：管理所有域名设置
- **批量操作**：批量启用/禁用域名
- **统计信息**：显示使用统计和域名数量

## 🔍 技术实现

### 内容提取引擎
```typescript
// 智能内容提取
const extractor = new ContentExtractor(settings);
const content = await extractor.extractFromCurrentPage();

// PDF处理
const pdfProcessor = new PDFProcessor();
const pdfContent = await pdfProcessor.extractFromPDF(url);
```

### 域名设置管理
```typescript
// 获取域名设置
const settings = await domainSettingsManager.getDomainSettings(domain);

// 应用智能设置
await domainSettingsManager.applySmartSettings(domain);
```

### Token估算
```typescript
// 估算Token数量
const tokenCount = TokenEstimator.estimateTokens(content, modelId);

// 智能分块
const chunks = TokenEstimator.smartChunk(content, maxTokens, modelId);
```

## 📈 性能优化

### 内容缓存
- **页面级缓存**：避免重复提取相同内容
- **域名设置缓存**：减少存储访问次数
- **智能更新**：只在内容变化时重新提取

### 异步处理
- **后台提取**：不阻塞用户界面操作
- **进度反馈**：实时显示处理进度
- **错误恢复**：自动重试和错误处理

### 内存管理
- **按需加载**：只在需要时加载PDF.js
- **内容清理**：定期清理过期缓存
- **资源释放**：及时释放不需要的资源

## 🛡️ 隐私保护

### 本地处理
- **本地提取**：所有内容提取在本地完成
- **无数据上传**：不向第三方服务发送页面内容
- **设置加密**：敏感设置本地加密存储

### 权限控制
- **域名隔离**：不同域名的设置完全隔离
- **用户控制**：用户完全控制哪些网站启用功能
- **透明操作**：所有操作对用户可见和可控

## 🔧 故障排除

### 常见问题

**内容提取失败：**
1. 检查域名是否启用内容提取
2. 尝试手动刷新内容
3. 检查网页是否包含有效内容

**PDF处理失败：**
1. 确认PDF文件可以正常访问
2. 检查PDF文件大小是否过大
3. 尝试重新加载页面

**Token超限：**
1. 调整最大Token数设置
2. 使用更精确的选择器
3. 启用智能分块功能

### 调试信息
- 在开发者工具中查看详细日志
- 检查网络请求是否正常
- 验证CSS选择器是否正确

## 🚀 未来计划

### 即将推出
- **多语言内容提取**：更好的国际化支持
- **图片内容识别**：OCR和图片描述提取
- **视频内容提取**：字幕和视频描述提取
- **实时协作**：多用户共享页面内容

### 长期规划
- **AI辅助设置**：自动优化提取规则
- **内容分析**：智能内容质量评估
- **批量处理**：多页面批量内容提取
- **API集成**：与其他工具的集成接口

---

现在您可以享受更智能的网页内容问答体验！🎉
